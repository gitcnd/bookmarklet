javascript:(()=>{const e=window.location.hostname,t=window.location.href;let n="",r="",s="";if(e.includes("chatgpt.com")){s="ChatGPT";const e=document.querySelectorAll(".user-message-bubble-color"),t=document.querySelectorAll("div[data-message-author-role='assistant']");if(e.length>0){const r=Array.from(e),s=Array.from(t);for(let e=0;e<Math.max(r.length,s.length);e++){if(e<r.length){const t=(r[e].textContent||"").trim();t&&(n+=`---\n### User\n\n${t}\n\n`)}if(e<s.length){const t=(s[e].textContent||"").trim();t&&(n+=`### Assistant\n\n${t}\n\n`)}}}else{const e=document.querySelectorAll("div[data-message-author-role]"),t=Array.from(e);for(let e=0;e<t.length;e++){const r=t[e];if("user"===r.getAttribute("data-message-author-role")){const s=r.querySelector(".whitespace-pre-wrap"),o=s?(s.innerText||s.textContent||"").trim():(r.textContent||"").trim();o&&(n+=`---\n### User\n\n${o}\n\n`);let c="",a=e+1;for(;a<t.length&&"user"!==t[a].getAttribute("data-message-author-role");){const e=(t[a].textContent||"").trim();e&&(c+=e+"\n\n"),a++}c.trim()&&(n+=`### Assistant\n\n${c.trim()}\n\n`),e=a-1}}}r=document.title.replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)}else if(e.includes("perplexity.ai")){s="Perplexity";const e=window.location.pathname.match(/\/search\/([^/?]+)/),o=e?e[1]:null;if(o)return void(async()=>{try{const e=await fetch(`/rest/thread/${o}`,{credentials:"include"});if(!e.ok)throw new Error(`API returned ${e.status}`);const c=await e.json();(c.entries||[]).forEach(e=>{try{const t=JSON.parse(e.text),r=t.find(e=>"INITIAL_QUERY"===e.step_type)?.content?.query,s=t.find(e=>"FINAL"===e.step_type)?.content?.answer;if(r&&(n+=`---\n### User\n\n${r}\n\n`),s)try{const e=JSON.parse(s);e.answer&&(n+=`### Assistant\n\n${e.answer}\n\n`)}catch{n+=`### Assistant\n\n${s}\n\n`}}catch{}}),r=document.title.replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60);const a=`[${s}](${t})\n\n${n}`,l=new Blob([a],{type:"text/markdown"}),i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=`${r||"chat_export"}.md`,i.click()}catch(e){alert(`Failed to fetch Perplexity thread: ${e.message}`)}})();const c=document.querySelectorAll('[class*="group/query"]'),a=document.querySelectorAll('div[class*="prose dark:prose-invert inline leading-relaxed"]');c.forEach((e,t)=>{const r=e.textContent?.trim();if(r&&(n+=`---\n### User\n\n${r}\n\n`,t<a.length)){let e=a[t].innerText?.trim()||"";e=e.replace(/^(Sources|Reviewed \d+ sources?)\s*/gi,"").replace(/\n{3,}/g,"\n\n").trim(),e&&(n+=`### Assistant\n\n${e}\n\n`)}}),r=document.title.replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)}else if(e.includes("deepseek.com")){s="DeepSeek";document.querySelectorAll("div.fbb737a4, div.ds-markdown").forEach(e=>{const t=e.classList.contains("fbb737a4")?"### User":"### Assistant",r=e.innerText.trim();r&&(n+=`${t}\n\n${r}\n\n---\n\n`)}),r=document.title.replace(" - DeepSeek","").trim().replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)}else if(e.includes("openrouter.ai")){s="OpenRouter";const e=document.body.innerText.split("\n").map(e=>e.trim()).filter(e=>e);let t="",o=0;for(;o<e.length;){const r=e[o];if("Chris"===r||"User"===r){if(o++,o<e.length){const r=e[o];for(t||(t=r.substring(0,60)),n+=`---\n### User\n\n${r}\n\n`,o++;o<e.length&&e[o].match(/(minute|hour|day|month)s? ago/);)o++}}else if(r.match(/.*(free|paid)\)$/)||"Deleted"===r){if(n+=`### Assistant (${"Deleted"===r?"Assistant":r})\n\n`,o++,e[o]?.startsWith("Reasoning")){for(n+=`**${e[o]}**\n\n`,o+=2;o<e.length&&"Collapse reasoning"!==e[o];)n+=e[o]+"\n\n",o++;o++}let t="";for(;o<e.length&&!e[o].match(/(minute|hour|day|month)s? ago/)&&"Chris"!==e[o]&&"User"!==e[o]&&!e[o].match(/.*(free|paid)\)$/)&&"Deleted"!==e[o];)t+=e[o]+"\n\n",o++;for(t&&(n+=t);o<e.length&&e[o].match(/(minute|hour|day|month)s? ago/);)o++}else o++}r=t.replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)||"openrouter_chat"}else if(e.includes("claude.ai")){s="Claude";document.querySelectorAll("div[data-test-render-count]").forEach(e=>{const t=e.closest('[class*="font-user"]')?"### User":"### Assistant",r=e.innerText.trim();r&&(n+=`---\n${t}\n\n${r}\n\n`)}),r=document.title.replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)}else if(e.includes("gemini.google.com")){s="Gemini";document.querySelectorAll(".conversation-container").forEach(e=>{const t=e.querySelector("user-query"),r=e.querySelector("model-response");if(t){const e=t.innerText?.trim();e&&(n+=`---\n### User\n\n${e}\n\n`)}if(r){let e=r.innerText?.trim();e&&(e.startsWith("Show thinking")&&(e=e.replace(/^Show thinking\s*/,"")),n+=`### Assistant\n\n${e}\n\n`)}});const e=document.querySelector('.conversation.active, .conversation.selected, .conversation[aria-current="page"]'),t=e?.querySelector(".conversation-title")?.textContent?.trim();r=(t||document.title).replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)||"gemini_chat"}else if(e.includes("aistudio.google.com")){s="Google AI Studio";document.querySelectorAll(".chat-turn-container").forEach(e=>{const t=e.classList.contains("user"),r=e.classList.contains("model");if(t||r){const r=t?"### User":"### Assistant";let s=(e.textContent||"").trim();s=s.replace(/^(edit|more_vert|User|Model|Thoughts|Expand to view model thoughts|chevron_right|content_copy|thumb_up|thumb_down|flag|share)+\s*/g,"").replace(/\s+(edit|more_vert|content_copy|thumb_up|thumb_down|flag|share)\s*$/g,"").replace(/Google Search Suggestions.*$/s,"").trim(),s&&(n+=`---\n${r}\n\n${s}\n\n`)}});const e=document.querySelector("h1")?.textContent?.trim();r=(e||document.title).replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)||"ai_studio_chat"}else{if(!e.includes("x.com")&&!e.includes("twitter.com"))return void alert("Unsupported site. Supported: ChatGPT, Perplexity, DeepSeek, OpenRouter, Claude, Gemini, Google AI Studio, X.com");{s="X";const e=document.querySelectorAll('article[data-testid="tweet"]');let t="",o="";e.forEach((e,r)=>{const s=e.querySelector('[data-testid="User-Name"]'),c=s?Array.from(s.querySelectorAll('a[href^="/"]')):[];let a="";for(const e of c){const t=e.getAttribute("href");if(t&&t.startsWith("/")&&!t.includes("/status/")&&t.length>1){a=t;break}}const l=s?.querySelector("span span")?.textContent||"",i=e.querySelector('[data-testid="tweetText"]'),d=i?.innerText||"",u=e.querySelector("time")?.getAttribute("datetime")||"",m=u?new Date(u).toLocaleString():"",g=Array.from(e.querySelectorAll("img")).map(e=>e.src).filter(e=>e&&e.includes("pbs.twimg.com")&&!e.includes("profile_images")&&!e.includes("emoji")),h=e.querySelector('[data-testid="card.wrapper"] a')?.href||"";0===r&&(t=a,o=d.substring(0,60));n+=`---\n### ${a===t?`**${l}** (${a})`:`**${l}** (${a}) â€” Reply`}\n`,m&&(n+=`*${m}*\n\n`),n+=`${d}\n\n`,g.length>0&&g.forEach((e,t)=>{const r=e.replace("name=small","name=large");n+=`![Image ${t+1}](${r})\n\n`}),h&&(n+=`ðŸ”— [Link](${h})\n\n`)}),r=(o||document.title).replace(/[^\w\d\s]+/g,"").replace(/\s+/g,"_").replace(/^_+|_+$/g,"").slice(0,60)||"x_thread"}}if(!n)return void alert("No conversation found to export");const o=new Blob([`[${s}](${t})\n\n${n}`],{type:"text/markdown"}),c=document.createElement("a");c.href=URL.createObjectURL(o),c.download=`${r||"chat_export"}.md`,c.click()})();